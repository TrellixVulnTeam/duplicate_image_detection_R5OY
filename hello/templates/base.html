<!DOCTYPE html>
<html>
<head>
<title>Duplicate Image Detection</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
{% load staticfiles %}

<link rel="stylesheet" type="text/css" href="{% static 'fake-bootstrap.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'base.css' %}" />
  
<script>

	window.onload = function() {
		// loading image at first
		var canvas = document.getElementById('big-photo');
		context = canvas.getContext('2d');
		base_image = new Image();
	 	base_image.src = "{% static 'background.png' %}";
	 	base_image.onload = function(){
		   context.drawImage(base_image, 0, 0, base_image.width, base_image.height, 0, 0, 285, 285);
		}
	}

	function changeBrightness(value) {
	    var amount = value/100.;
	    var img = document.getElementById('big-photo');
        /* We change the brightness of the canvas itself */
        img.setAttribute('style', 'filter:brightness(' + amount + '); -webkit-filter:brightness(' + amount + '); -moz-filter:brightness(' + amount + ')');
	}

	function tintColor(value) {
		tintColor = "#550000";
		RGB = color(value);

		var canvas = document.getElementById('big-photo');
		ctx = canvas.getContext('2d');
		var map = ctx.getImageData(0,0,canvas.width,canvas.height);
	    var imdata = map.data;

	    // convert image to grayscale
	    // var r,g,b,avg;
	    // for(var p = 0, len = imdata.length; p < len; p+=4) {
	    //     r = imdata[p]
	    //     g = imdata[p+1];
	    //     b = imdata[p+2];
	    //     // alpha channel (p+3) is ignored           

	    //     avg = Math.floor((r+g+b)/3);

	    //     imdata[p] = imdata[p+1] = imdata[p+2] = avg;
	    // }

	    // ctx.putImageData(map,0,0);

	    for (var i = 0; i < imdata.length; i += 4) {
	      var avg = (imdata[i] + imdata[i +1] + imdata[i +2]) / 3;
	      imdata[i]     = avg; // red
	      imdata[i + 1] = avg; // green
	      imdata[i + 2] = avg; // blue
	    }
	    ctx.putImageData(map, 0, 0);

	    // overlay filled rectangle using lighter composition
	    // ctx.globalCompositeOperation = "lighter";
	    // ctx.globalAlpha = 0.5;
	    // ctx.fillStyle=tintColor;
	    // ctx.fillRect(0,0,canvas.width,canvas.height);

	    // replace image source with canvas data
	    // ctx.drawImage(newImage, 0, 0);
	}

	function color(val) {
		value = val/100.
	    var RGB = {R:0,G:0,B:0};
	    if (value == 0) { 
	    	// implement to stay same if possible
	    } else if (0 < value && value <= 1/8) {
	        RGB.R = 0;
	        RGB.G = 0;
	        RGB.B = 4*value + .5; // .5 - 1 // b = 1/2
	    } else if (1/8 < value && value <= 3/8) {
	        RGB.R = 0;
	        RGB.G = 4*value - .5; // 0 - 1 // b = - 1/2
	        RGB.B = 1; // small fix
	    } else if (3/8 < value && value <= 5/8) {
	        RGB.R = 4*value - 1.5; // 0 - 1 // b = - 3/2
	        RGB.G = 1;
	        RGB.B = -4*value + 2.5; // 1 - 0 // b = 5/2
	    } else if (5/8 < value && value <= 7/8) {
	        RGB.R = 1;
	        RGB.G = -4*value + 3.5; // 1 - 0 // b = 7/2
	        RGB.B = 0;
	    } else if (7/8 < value && value <= 1) {
	        RGB.R = -4*value + 4.5; // 1 - .5 // b = 9/2
	        RGB.G = 0;
	        RGB.B = 0;
	    } else {    // should never happen - value > 1
	        RGB.R = .5;
	        RGB.G = 0;
	        RGB.B = 0;
	    }

	    // scale for hex conversion
	    RGB.R *= 15;
	    RGB.G *= 15;
	    RGB.B *= 15;
	    return RGB;
	}

 	function showImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            var canvas = document.getElementById('big-photo');
			context = canvas.getContext('2d');

            reader.onload = function (e) {
            	base_image = new Image();
            	base_image.src = e.target.result;
		   		context.drawImage(base_image, 0, 0, base_image.width, base_image.height, 0, 0, canvas.width, canvas.height);
            	$("#image_url").val(e.target.result);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
</head>

<body>

{% block content %}{% endblock %}

</body>
</html>
